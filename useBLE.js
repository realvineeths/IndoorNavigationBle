/* eslint-disable prettier/prettier */
import { useState } from 'react';
import { PermissionsAndroid, Platform } from 'react-native';
import { BleManager, ScanMode } from 'react-native-ble-plx';
import { PERMISSIONS, requestMultiple } from 'react-native-permissions';
import DeviceInfo from 'react-native-device-info';
// import trilateration from './findCord';
// import MathTool from  './MathTool';
import {MathTool} from './MathTool';
import KalmanFilter from 'kalmanjs';


const bleManager = new BleManager();
let beaconData = [];

// var a = 4.8034392256422;
// var a = 5.843414133735177;
// var b = 0.27667516330004;
// var b = 3.686945064519575;
// var c = 4.298662347082277;
// var c = 1.0827771103723;
var a=1000;
var b=1000;
var c=1000;
var d=1000;
var e=1000;

// function trilateration(beacons) {
//   // beacons: array of { x, y, distance }

//   const beacon1 = beacons[0];
//   const beacon2 = beacons[1];
//   const beacon3 = beacons[2];

//   const A = 2 * (beacon2.x - beacon1.x);
//   const B = 2 * (beacon2.y - beacon1.y);
//   const C = Math.pow(beacon1.distance, 2) - Math.pow(beacon2.distance, 2) - Math.pow(beacon1.x, 2) + Math.pow(beacon2.x, 2) - Math.pow(beacon1.y, 2) + Math.pow(beacon2.y, 2);

//   const D = 2 * (beacon3.x - beacon2.x);
//   const E = 2 * (beacon3.y - beacon2.y);
//   const F = Math.pow(beacon2.distance, 2) - Math.pow(beacon3.distance, 2) - Math.pow(beacon2.x, 2) + Math.pow(beacon3.x, 2) - Math.pow(beacon2.y, 2) + Math.pow(beacon3.y, 2);

//   const x = (C - (F * B / E)) / (A - (D * B / E));
//   const y = (F - (D * C / A)) / (E - (B * D / A));

//   return { x, y };
// }


function trilateration(beacons) {

  // Sort beacons by distance in ascending order
  const sortedBeacons = beacons.sort((a, b) => a.distance - b.distance);

  const beacon1 = sortedBeacons[0];
  const beacon2 = sortedBeacons[1];
  const beacon3 = sortedBeacons[2];

  if (!isIntersection(beacon1, beacon2, beacon1.distance, beacon2.distance)) {
      return calculateMidpoint(beacon1, beacon2);
  }

  // Calculate the intersection points of the circles formed by the two nearest beacons
  const intersectionPoints = calculateCircleIntersection(beacon1, beacon2);
  // console.log(intersectionPoints);
  // Choose the intersection point closest to the third beacon
  const closestIntersection = intersectionPoints.sort((p1, p2) => {
      return getDistance(p1, beacon3) - getDistance(p2, beacon3);
  })[0];
  return closestIntersection;
}

function isIntersection(beacon1, beacon2, r1, r2) {
  const distanceBetweenCenters = getDistance(beacon1, beacon2);
  const sumOfRadii = r1 + r2;
  const differenceOfRadii = Math.abs(r1 - r2);

  // Circles intersect if the distance between their centers is less than the sum of their radii
  // and greater than the absolute difference of their radii
  return distanceBetweenCenters < sumOfRadii && distanceBetweenCenters > differenceOfRadii;
}

function calculateMidpoint(point1, point2) {
  const x = (point1.x + point2.x) / 2;
  const y = (point1.y + point2.y) / 2;
  return { x, y };
}

// Helper function to calculate the intersection points of two circles
function calculateCircleIntersection(beacon1, beacon2) {
  const d = getDistance(beacon1, beacon2);
  const a = (Math.pow(beacon1.distance, 2) - Math.pow(beacon2.distance, 2) + Math.pow(d, 2)) / (2 * d);
  const h = Math.sqrt(Math.pow(beacon1.distance, 2) - Math.pow(a, 2));

  const x2 = beacon1.x + (a / d) * (beacon2.x - beacon1.x);
  const y2 = beacon1.y + (a / d) * (beacon2.y - beacon1.y);

  const x3_1 = x2 + (h / d) * (beacon2.y - beacon1.y);
  const y3_1 = y2 - (h / d) * (beacon2.x - beacon1.x);

  const x3_2 = x2 - (h / d) * (beacon2.y - beacon1.y);
  const y3_2 = y2 + (h / d) * (beacon2.x - beacon1.x);

  return [{ x: x3_1, y: y3_1 }, { x: x3_2, y: y3_2 }];
}

// Helper function to calculate the distance between two points
function getDistance(point1, point2) {
  return Math.sqrt(Math.pow(point1.x - point2.x, 2) + Math.pow(point1.y - point2.y, 2));
}

//Converts latitude,longitude to cartesian cordinates for our algo
function cartesian(latitude, longitude) {
  const MAP_WIDTH = 3800;
  const MAP_HEIGHT = 2000.6666666666666;

  var x = (MAP_WIDTH / 360.0) * (180 + longitude);
  var y = (MAP_HEIGHT / 180.0) * (90 - latitude);

  return [x*Math.pow(10,4), y*Math.pow(10,4)];
}

//Converts back our cartesian cordinates to its relative latitude,longitude
function getcord(x, y) {
  x=x*Math.pow(10,-4);
  y=y*Math.pow(10,-4);
  const MAP_WIDTH = 3800;
  const MAP_HEIGHT = 2000.6666666666666;
  // const MAP_WIDTH = 360;
  // const MAP_HEIGHT = 761.6666666666666;
  var longitude = (x * (360.0 / MAP_WIDTH)) - 180;
  var latitude = 90 - (y * (180.0 / MAP_HEIGHT));
  return [latitude, longitude]
}




function useBLE() {
  const [distance, setDistance] = useState([]);
  var [cordinates, setCordinates] = useState([77.66429275926333, 12.861467014260677]);


  const requestPermissions = async (cb) => {
    if (Platform.OS === 'android') {
      const apiLevel = await DeviceInfo.getApiLevel();
      const granted = await PermissionsAndroid.request(
        PermissionsAndroid.PERMISSIONS.ACCESS_FINE_LOCATION,
        {
          title: 'Location Permission',
          message: 'Bluetooth Low Energy requires Location',
          buttonNeutral: 'Ask Later',
          buttonNegative: 'Cancel',
          buttonPositive: 'OK',
        },
      );
      cb(granted === PermissionsAndroid.RESULTS.GRANTED);
    } else {
      cb(true);
    }
  };

  function calculateDistance(rssi) {
    const currentDistance = Math.pow(10, (-55 - rssi) / (10 * 3));
    return currentDistance;
  }

  const kf1 = new KalmanFilter();
  const kf2 = new KalmanFilter();
  const kf3 = new KalmanFilter();
  const kf4 = new KalmanFilter();
  const kf5 = new KalmanFilter();

  // var cordinates=[a,b,c];
  const scanForPeripherals = () =>
    bleManager.startDeviceScan(
      null,
      {
        allowDuplicates: true,
        scanMode: ScanMode.LowLatency,
      },
      (error, device) => {
        if (device && device.name && device.name.includes('FSC')) {
          // console.log(device);

          const beacon = {
            id: device.id,
            rssi: device.rssi,
            distance: calculateDistance(device.rssi),
          };

          // console.log(beacon);

          beaconData.push(beacon);

          // Sort the beaconData array based on distance in ascending order
          beaconData.sort((a, b) => a.distance - b.distance);

          // Keep only the 3 closest beacons
          // if (beaconData.length > 3) {
          //   beaconData.pop();
          // }

          // const top3Objects = beaconData.slice(0, 3);

          if(beacon.id.includes('37')){
            a=beacon.distance;
          }
          if(beacon.id.includes('4B')){
            b=beacon.distance;
          }
          if(beacon.id.includes('48')){
            c=beacon.distance;
          }
          if(beacon.id.includes('47')){
            d=beacon.distance;
          }
          if(beacon.id.includes('3C')){
            e=beacon.distance;
          }   

          // const cart3 = [0,10];//c
          // const cart2 = [0,1];//b
          // const cart1 = [10,0];//a
          // const cart4 = [5,9];//d
          // const cart5 = [11,8];//e
          const cart1 = cartesian(12.86137334, 77.66416349);//conf
          const cart2 = cartesian(12.86148900, 77.66417709);//hod
          const cart3 = cartesian(12.86147617, 77.66430172);//entra
          const cart4 = cartesian(12.86140970,77.66431894);//stair
          const cart5 = cartesian(12.86133558,77.66429186);//equip          
  

          var  arr=[];
          var cnt=(a!=1000)+(b!=1000)+(c!=1000)+(d!=1000)+(e!=1000);         

          // top3Objects.length>=3
          if(cnt>=3)
          {
            a=a!=1000?kf1.filter(a):a;
            b=b!=1000?kf2.filter(b):b;
            c=c!=1000?kf3.filter(c):c;
            d=d!=1000?kf4.filter(d):d;
            e=e!=1000?kf5.filter(e):e;
            console.log(a,b,c,d,e);
            const beaconArr=[
              {
                x: cart1[0], y: cart1[1],
                distance:a
              },
              {
                x: cart2[0], y: cart2[1],
                distance:b                
              },
              {
                x: cart3[0], y: cart3[1],
                distance:c
              },
              {
                x: cart4[0], y: cart4[1],
                distance:d
              },
              {
                x: cart5[0], y: cart5[1],
                distance:e
              }
            ]

            beaconArr.sort((a, b) => a.distance - b.distance);
            const top3Objects =beaconArr.slice(0, 3);
            
            // console.log(top3Objects);

            const userPosition = trilateration(top3Objects);    
            const userLatLon=getcord(userPosition.x,userPosition.y);

            arr.push(userLatLon[1]);
            arr.push(userLatLon[0]);
          }
          if(arr.length===2)
          {
            setCordinates(arr);
          }

          // disCalc(setCordinates);
          setDistance([...beaconData]);
        }
        if (error) {
          console.log(error, 'error');
        }
      },
  );


  return {
    scanForPeripherals,
    requestPermissions,
    distance,
    cordinates
  };
}

export default useBLE;




// 9.671645748089697 10.361178953541234 9.057034432735684 4.307541826127636 4.525439199428578
//  LOG  9.553676547923697 10.361178953541234 9.057034432735684 4.307541826127636 4.525439199428578
//  LOG  9.553676547923697 10.239397271580042 9.057034432735684 4.307541826127636 4.525439199428578
//  LOG  7.943282347242816 8.576958985908941 1000 1000 2.712272579332028
//  LOG  9.553676547923697 10.239397271580042 9.057034432735684 4.307541826127636 4.388004439565311
//  LOG  7.943282347242816 8.576958985908941 1000 1000 2.51188643150958
//  LOG  9.332250748683279 10.239397271580042 9.057034432735684 4.307541826127636 4.388004439565311
//  LOG  6.309573444801933 8.576958985908941 1000 1000 2.51188643150958
//  LOG  9.332250748683279 10.239397271580042 9.36667461108384 4.307541826127636 4.388004439565311
//  LOG  6.309573444801933 8.576958985908941 13.593563908785255 1000 2.51188643150958
//  LOG  9.332250748683279 10.239397271580042 9.36667461108384 4.306935758540359 4.388004439565311
//  LOG  6.309573444801933 8.576958985908941 13.593563908785255 4.298662347082277 2.51188643150958
//  LOG  9.332250748683279 10.239397271580042 9.464352570259377 4.306935758540359 4.388004439565311
//  LOG  6.309573444801933 8.576958985908941 10.7977516232771 4.298662347082277 2.51188643150958
//  LOG  9.332250748683279 10.172629686988545 9.464352570259377 4.306935758540359 4.388004439565311
//  LOG  6.309573444801933 9.261187281287935 10.7977516232771 4.298662347082277 2.51188643150958
//  LOG  9.332250748683279 10.172629686988545 9.464352570259377 4.306935758540359 4.205308288362408
//  LOG  6.309573444801933 9.261187281287935 10.7977516232771 4.298662347082277 1.7113283041617808
//  LOG  9.332250748683279 10.172629686988545 9.464352570259377 4.246026017916475 4.205308288362408
//  LOG  6.309573444801933 9.261187281287935 10.7977516232771 3.4145488738336014 1.7113283041617808
//  LOG  9.332250748683279 10.64636300014426 9.464352570259377 4.246026017916475 4.205308288362408
//  LOG  6.309573444801933 17.11328304161781 10.7977516232771 3.4145488738336014 1.7113283041617808
//  LOG  9.332250748683279 10.64636300014426 9.464352570259377 4.246026017916475 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 10.7977516232771 3.4145488738336014 1.2589254117941673
//  LOG  9.12593833678142 10.64636300014426 9.464352570259377 4.246026017916475 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 10.7977516232771 3.4145488738336014 1.2589254117941673
//  LOG  8.933707749409043 10.64636300014426 9.464352570259377 4.246026017916475 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 10.7977516232771 3.4145488738336014 1.2589254117941673
//  LOG  8.933707749409043 10.64636300014426 9.249023567326681 4.246026017916475 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 6.309573444801933 3.4145488738336014 1.2589254117941673
//  LOG  8.933707749409043 10.64636300014426 9.249023567326681 4.141339893940827 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 6.309573444801933 2.712272579332028 1.2589254117941673
//  LOG  8.933707749409043 10.64636300014426 8.987107266958725 4.141339893940827 4.004203341807057
//  LOG  6.309573444801933 17.11328304161781 5.411695265464636 2.712272579332028 1.2589254117941673
//  LOG  8.933707749409043 10.289071494499886 8.987107266958725 4.141339893940827 4.004203341807057
//  LOG  6.309573444801933 5.411695265464636 5.411695265464636 2.712272579332028 1.2589254117941673
//  LOG  8.933707749409043 10.289071494499886 8.987107266958725 4.141339893940827 4.413445594443436
//  LOG  6.309573444801933 5.411695265464636 5.411695265464636 2.712272579332028 10
//  LOG  8.933707749409043 10.289071494499886 8.987107266958725 4.091732875693568 4.413445594443436
//  LOG  6.309573444801933 5.411695265464636 5.411695265464636 3.4145488738336014 10
//  LOG  8.933707749409043 9.956166870079235 8.987107266958725 4.091732875693568 4.413445594443436
//  LOG  6.309573444801933 5.411695265464636 5.411695265464636 3.4145488738336014 10
//  LOG  8.933707749409043 9.956166870079235 8.987107266958725 4.091732875693568 4.614318069779033
//  LOG  6.309573444801933 5.411695265464636 5.411695265464636 3.4145488738336014 7.3564225445964135
//  LOG  8.666023428179635 9.956166870079235 8.987107266958725 4.091732875693568 4.614318069779033
//  LOG  5.011872336272722 5.411695265464636 5.411695265464636 3.4145488738336014 7.3564225445964135
//  LOG  8.666023428179635 9.956166870079235 8.772534936969672 4.091732875693568 4.614318069779033
//  LOG  5.011872336272722 5.411695265464636 5.843414133735177 3.4145488738336014 7.3564225445964135
//  LOG  8.666023428179635 9.956166870079235 8.772534936969672 3.9385769536901107 4.614318069779033
//  LOG  5.011872336272722 5.411695265464636 5.843414133735177 1.847849797422291 7.3564225445964135
//  LOG  8.666023428179635 9.956166870079235 8.425418719832143 3.9385769536901107 4.614318069779033
//  LOG  5.011872336272722 5.411695265464636 3.686945064519575 1.847849797422291 7.3564225445964135
//  LOG  8.666023428179635 9.675451514016677 8.425418719832143 3.9385769536901107 4.614318069779033
//  LOG  5.011872336272722 5.843414133735177 3.686945064519575 1.847849797422291 7.3564225445964135
//  LOG  8.666023428179635 9.675451514016677 8.425418719832143 3.8168005759432897 4.614318069779033
//  LOG  5.011872336272722 5.843414133735177 3.686945064519575 2.154434690031884 7.3564225445964135
//  LOG  8.666023428179635 10.096821545877395 8.425418719832143 3.8168005759432897 4.614318069779033
//  LOG  5.011872336272722 15.848931924611133 3.686945064519575 2.154434690031884 7.3564225445964135
//  LOG  8.666023428179635 10.096821545877395 8.425418719832143 3.8168005759432897 4.515209257088758
//  LOG  5.011872336272722 15.848931924611133 3.686945064519575 2.154434690031884 3.1622776601683795
//  LOG  8.666023428179635 10.096821545877395 8.435762079249596 3.8168005759432897 4.515209257088758
//  LOG  5.011872336272722 15.848931924611133 8.576958985908941 2.154434690031884 3.1622776601683795
//  LOG  8.666023428179635 10.096821545877395 8.435762079249596 3.6564698240395 4.515209257088758
//  LOG  5.011872336272722 15.848931924611133 8.576958985908941 1.4677992676220695 3.1622776601683795
//  LOG  8.666023428179635 10.096821545877395 8.324995269907223 3.6564698240395 4.515209257088758
//  LOG  5.011872336272722 15.848931924611133 6.812920690579613 1.4677992676220695 3.1622776601683795
//  LOG  8.666023428179635 10.096821545877395 8.324995269907223 3.6564698240395 4.392150069274278
//  LOG  5.011872336272722 15.848931924611133 6.812920690579613 1.4677992676220695 2.712272579332028
//  LOG  8.666023428179635 10.039785447395646 8.324995269907223 3.6564698240395 4.392150069274278
//  LOG  5.011872336272722 9.261187281287935 6.812920690579613 1.4677992676220695 2.712272579332028
//  LOG  8.666023428179635 10.039785447395646 8.324995269907223 3.6564698240395 4.364091973727573
//  LOG  5.011872336272722 9.261187281287935 6.812920690579613 1.4677992676220695 3.9810717055349722
//  LOG  8.811524234482297 10.039785447395646 8.324995269907223 3.6564698240395 4.364091973727573
//  LOG  10.7977516232771 9.261187281287935 6.812920690579613 1.4677992676220695 3.9810717055349722
//  LOG  9.211939207826592 10.039785447395646 8.324995269907223 3.6564698240395 4.364091973727573
//  LOG  14.677992676220699 9.261187281287935 6.812920690579613 1.4677992676220695 3.9810717055349722
//  LOG  9.211939207826592 10.039785447395646 8.324995269907223 3.4928257694532028 4.364091973727573
//  LOG  14.677992676220699 9.261187281287935 6.812920690579613 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.039785447395646 8.258885475602051 3.4928257694532028 4.364091973727573
//  LOG  14.677992676220699 9.261187281287935 7.3564225445964135 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.282348093388563 8.258885475602051 3.4928257694532028 4.364091973727573
//  LOG  14.677992676220699 13.593563908785255 7.3564225445964135 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.282348093388563 8.258885475602051 3.3403512166570475 4.364091973727573
//  LOG  14.677992676220699 13.593563908785255 7.3564225445964135 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.282348093388563 8.064550910711112 3.3403512166570475 4.364091973727573
//  LOG  14.677992676220699 13.593563908785255 5.411695265464636 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.011186921931682 8.064550910711112 3.3403512166570475 4.364091973727573
//  LOG  14.677992676220699 6.309573444801933 5.411695265464636 1.2589254117941673 3.9810717055349722
//  LOG  9.211939207826592 10.011186921931682 8.064550910711112 3.3403512166570475 4.266115713947671
//  LOG  14.677992676220699 6.309573444801933 5.411695265464636 1.2589254117941673 2.9286445646252366
//  LOG  9.211939207826592 10.011186921931682 8.064550910711112 3.3403512166570475 4.160058370677057
//  LOG  14.677992676220699 6.309573444801933 5.411695265464636 1.2589254117941673 2.712272579332028
//  LOG  9.211939207826592 10.011186921931682 8.064550910711112 3.205138695152209 4.160058370677057
//  LOG  14.677992676220699 6.309573444801933 5.411695265464636 1.3593563908785256 2.712272579332028
//  LOG  9.211939207826592 10.011186921931682 7.747165679701688 3.205138695152209 4.160058370677057
//  LOG  14.677992676220699 6.309573444801933 3.4145488738336014 1.3593563908785256 2.712272579332028
//  LOG  9.211939207826592 10.011186921931682 7.747165679701688 3.086556838375602 4.160058370677057
//  LOG  14.677992676220699 6.309573444801933 3.4145488738336014 1.4677992676220695 2.712272579332028
//  LOG  9.211939207826592 10.011186921931682 7.76055159509239 3.086556838375602 4.160058370677057
//  LOG  14.677992676220699 6.309573444801933 7.943282347242816 1.4677992676220695 2.712272579332028
//  LOG  9.211939207826592 10.409641380994529 7.76055159509239 3.086556838375602 4.160058370677057
//  LOG  14.677992676220699 15.848931924611133 7.943282347242816 1.4677992676220695 2.712272579332028
//  LOG  9.211939207826592 10.409641380994529 7.76055159509239 3.086556838375602 4.2181988123592165
//  LOG  14.677992676220699 15.848931924611133 7.943282347242816 1.4677992676220695 5.011872336272722
//  LOG  8.98202100557201 10.409641380994529 7.76055159509239 3.086556838375602 4.2181988123592165
//  LOG  5.843414133735177 15.848931924611133 7.943282347242816 1.4677992676220695 5.011872336272722
//  LOG  8.98202100557201 10.409641380994529 7.76055159509239 3.086556838375602 4.395301186979754
//  LOG  5.843414133735177 15.848931924611133 7.943282347242816 1.4677992676220695 6.812920690579613
//  LOG  9.630201697227033 10.409641380994529 7.76055159509239 3.086556838375602 4.395301186979754
//  LOG  18.478497974222908 15.848931924611133 7.943282347242816 1.4677992676220695 6.812920690579613
//  LOG  9.244621129048952 10.409641380994529 7.76055159509239 3.086556838375602 4.395301186979754
//  LOG  3.9810717055349722 15.848931924611133 7.943282347242816 1.4677992676220695 6.812920690579613
//  LOG  9.244621129048952 10.409641380994529 7.547667233170289 3.086556838375602 4.395301186979754
//  LOG  3.9810717055349722 15.848931924611133 4.641588833612778 1.4677992676220695 6.812920690579613
//  LOG  9.245751849425757 10.409641380994529 7.547667233170289 3.086556838375602 4.395301186979754
//  LOG  9.261187281287935 15.848931924611133 4.641588833612778 1.4677992676220695 6.812920690579613
//  LOG  9.245751849425757 10.409641380994529 7.547667233170289 3.0346659613136766 4.395301186979754
//  LOG  9.261187281287935 15.848931924611133 4.641588833612778 2.326305067153626 6.812920690579613
//  LOG  9.245751849425757 10.409641380994529 7.431343679036333 3.0346659613136766 4.395301186979754
//  LOG  9.261187281287935 15.848931924611133 5.843414133735177 2.326305067153626 6.812920690579613
//  LOG  9.245751849425757 10.409641380994529 7.431343679036333 3.0346659613136766 4.412111515448652
//  LOG  9.261187281287935 15.848931924611133 5.843414133735177 2.326305067153626 4.641588833612778
//  LOG  9.245751849425757 10.409641380994529 7.431343679036333 2.986316888722586 4.412111515448652
//  LOG  9.261187281287935 15.848931924611133 5.843414133735177 2.326305067153626 4.641588833612778
//  LOG  9.245751849425757 10.409641380994529 7.124012588156992 2.986316888722586 4.412111515448652
//  LOG  9.261187281287935 15.848931924611133 2.9286445646252366 2.326305067153626 4.641588833612778
//  LOG  9.245751849425757 10.436131790660228 7.124012588156992 2.986316888722586 4.412111515448652
//  LOG  9.261187281287935 10.7977516232771 2.9286445646252366 2.326305067153626 4.641588833612778
//  LOG  9.245751849425757 10.436131790660228 7.124012588156992 2.986316888722586 4.575978405959845
//  LOG  9.261187281287935 10.7977516232771 2.9286445646252366 2.326305067153626 6.812920690579613
//  LOG  9.616528678344816 10.436131790660228 7.124012588156992 2.986316888722586 4.575978405959845
//  LOG  14.677992676220699 10.7977516232771 2.9286445646252366 2.326305067153626 6.812920690579613
//  LOG  9.616528678344816 10.040626081110085 7.124012588156992 2.986316888722586 4.575978405959845
//  LOG  14.677992676220699 4.641588833612778 2.9286445646252366 2.326305067153626 6.812920690579613
//  LOG  9.592274901572896 10.040626081110085 7.124012588156992 2.986316888722586 4.575978405959845
//  LOG  9.261187281287935 4.641588833612778 2.9286445646252366 2.326305067153626 6.812920690579613
//  LOG  9.592274901572896 10.040626081110085 7.124012588156992 3.0992972410842756 4.575978405959845
//  LOG  9.261187281287935 4.641588833612778 2.9286445646252366 4.641588833612778 6.812920690579613
//  LOG  9.592274901572896 10.040626081110085 6.909491602969791 3.0992972410842756 4.575978405959845
//  LOG  9.261187281287935 4.641588833612778 3.9810717055349722 4.641588833612778 6.812920690579613
//  LOG  9.592274901572896 10.040626081110085 6.909491602969791 3.0728809275640647 4.575978405959845
//  LOG  9.261187281287935 4.641588833612778 3.9810717055349722 2.712272579332028 6.812920690579613
//  LOG  9.592274901572896 10.523369281100967 6.909491602969791 3.0728809275640647 4.575978405959845
//  LOG  9.261187281287935 17.11328304161781 3.9810717055349722 2.712272579332028 6.812920690579613
//  LOG  9.592274901572896 10.523369281100967 6.909491602969791 3.0728809275640647 5.000644656467445
//  LOG  9.261187281287935 17.11328304161781 3.9810717055349722 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.523369281100967 6.909491602969791 3.0728809275640647 5.000644656467445
//  LOG  11.659144011798316 17.11328304161781 3.9810717055349722 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.48764678488118 6.909491602969791 3.0728809275640647 5.000644656467445
//  LOG  11.659144011798316 10 3.9810717055349722 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.48764678488118 6.909491602969791 3.0728809275640647 5.396325372140952
//  LOG  11.659144011798316 10 3.9810717055349722 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.48764678488118 6.5546917025994915 3.0728809275640647 5.396325372140952
//  LOG  11.659144011798316 10 1.7113283041617808 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.48764678488118 6.307196368317426 3.0728809275640647 5.396325372140952
//  LOG  11.659144011798316 10 2.9286445646252366 2.712272579332028 10.7977516232771
//  LOG  9.733348760209594 10.48764678488118 6.307196368317426 3.063036095022501 5.396325372140952
//  LOG  11.659144011798316 10 2.9286445646252366 2.9286445646252366 10.7977516232771
//  LOG  9.733348760209594 10.699640718656255 6.307196368317426 3.063036095022501 5.396325372140952
//  LOG  11.659144011798316 13.593563908785255 2.9286445646252366 2.9286445646252366 10.7977516232771
//  LOG  9.733348760209594 10.699640718656255 6.307196368317426 3.063036095022501 5.887277705817324
//  LOG  11.659144011798316 13.593563908785255 2.9286445646252366 2.9286445646252366 12.589254117941675
//  LOG  9.534015355585522 10.699640718656255 6.307196368317426 3.063036095022501 5.887277705817324
//  LOG  6.812920690579613 13.593563908785255 2.9286445646252366 2.9286445646252366 12.589254117941675
//  LOG  9.534015355585522 10.554757377367372 6.307196368317426 3.063036095022501 5.887277705817324
//  LOG  6.812920690579613 8.576958985908941 2.9286445646252366 2.9286445646252366 12.589254117941675
//  LOG  9.534015355585522 10.554757377367372 6.307196368317426 3.063036095022501 6.16799098401719
//  LOG  6.812920690579613 8.576958985908941 2.9286445646252366 2.9286445646252366 10
//  LOG  9.534015355585522 10.554757377367372 6.023750207621577 3.063036095022501 6.16799098401719
//  LOG  6.812920690579613 8.576958985908941 2.154434690031884 2.9286445646252366 10
//  LOG  9.534015355585522 10.554757377367372 6.023750207621577 3.02541745273238 6.16799098401719
//  LOG  6.812920690579613 8.576958985908941 2.154434690031884 2.51188643150958 10
//  LOG  9.534015355585522 10.554757377367372 5.729406460849914 3.02541745273238 6.16799098401719
//  LOG  6.812920690579613 8.576958985908941 1.7113283041617808 2.51188643150958 10
//  LOG  9.534015355585522 10.33645548595159 5.729406460849914 3.02541745273238 6.16799098401719
//  LOG  6.812920690579613 7.3564225445964135 1.7113283041617808 2.51188643150958 10
//  LOG  9.534015355585522 10.33645548595159 5.729406460849914 3.02541745273238 6.674822413207575
//  LOG  6.812920690579613 7.3564225445964135 1.7113283041617808 2.51188643150958 13.593563908785255
//  LOG  9.225357123728859 10.33645548595159 5.729406460849914 3.02541745273238 6.674822413207575
//  LOG  5.011872336272722 7.3564225445964135 1.7113283041617808 2.51188643150958 13.593563908785255
//  LOG  9.225357123728859 10.712708785204102 5.729406460849914 3.02541745273238 6.674822413207575
//  LOG  5.011872336272722 15.848931924611133 1.7113283041617808 2.51188643150958 13.593563908785255
//  LOG  9.225357123728859 10.712708785204102 5.729406460849914 3.02541745273238 7.689739702895272
//  LOG  5.011872336272722 15.848931924611133 1.7113283041617808 2.51188643150958 21.544346900318832
//  LOG  8.889086268923327 10.712708785204102 5.729406460849914 3.02541745273238 7.689739702895272
//  LOG  4.298662347082277 15.848931924611133 1.7113283041617808 2.51188643150958 21.544346900318832
//  LOG  8.889086268923327 10.712708785204102 5.729406460849914 3.0347588268238943 7.689739702895272
//  LOG  4.298662347082277 15.848931924611133 1.7113283041617808 3.1622776601683795 21.544346900318832
//  LOG  8.889086268923327 10.712708785204102 5.4015587363642386 3.0347588268238943 7.689739702895272
//  LOG  4.298662347082277 15.848931924611133 0.9261187281287935 3.1622776601683795 21.544346900318832
//  LOG  8.889086268923327 10.712708785204102 5.159000835620597 3.0347588268238943 7.689739702895272
//  LOG  4.298662347082277 15.848931924611133 1.847849797422291 3.1622776601683795 21.544346900318832
//  LOG  8.889086268923327 10.152962815947568 5.159000835620597 3.0347588268238943 7.689739702895272
//  LOG  4.298662347082277 2.51188643150958 1.847849797422291 3.1622776601683795 21.544346900318832
//  LOG  8.889086268923327 10.152962815947568 5.159000835620597 3.0347588268238943 7.666989187423153
//  LOG  4.298662347082277 2.51188643150958 1.847849797422291 3.1622776601683795 7.3564225445964135
//  LOG  9.644226413123572 10.152962815947568 5.159000835620597 3.0347588268238943 7.666989187423153
//  LOG  19.952623149688797 2.51188643150958 1.847849797422291 3.1622776601683795 7.3564225445964135
//  LOG  9.644226413123572 10.152962815947568 5.159000835620597 3.027516012873709 7.666989187423153
//  LOG  19.952623149688797 2.51188643150958 1.847849797422291 2.9286445646252366 7.3564225445964135
//  LOG  9.644226413123572 10.152962815947568 4.915050624207201 3.027516012873709 7.666989187423153
//  LOG  19.952623149688797 2.51188643150958 1.5848931924611136 2.9286445646252366 7.3564225445964135
//  LOG  9.644226413123572 9.596160122646001 4.915050624207201 3.027516012873709 7.666989187423153
//  LOG  19.952623149688797 1.9952623149688795 1.5848931924611136 2.9286445646252366 7.3564225445964135
//  LOG  9.644226413123572 9.596160122646001 4.915050624207201 3.027516012873709 7.437084515586187
//  LOG  19.952623149688797 1.9952623149688795 1.5848931924611136 2.9286445646252366 4.298662347082277
//  LOG  9.644226413123572 9.596160122646001 4.915050624207201 3.1376843248464947 7.437084515586187
//  LOG  19.952623149688797 1.9952623149688795 1.5848931924611136 4.641588833612778 4.298662347082277
//  LOG  9.644226413123572 9.06730029785796 4.915050624207201 3.1376843248464947 7.437084515586187
//  LOG  19.952623149688797 1.847849797422291 1.5848931924611136 4.641588833612778 4.298662347082277
//  LOG  9.644226413123572 9.06730029785796 4.915050624207201 3.1376843248464947 7.857294145368205
//  LOG  19.952623149688797 1.847849797422291 1.5848931924611136 4.641588833612778 13.593563908785255
//  LOG  9.416620146656104 9.06730029785796 4.915050624207201 3.1376843248464947 7.857294145368205
//  LOG  6.309573444801933 1.847849797422291 1.5848931924611136 4.641588833612778 13.593563908785255
//  LOG  9.025541984728763 9.06730029785796 4.915050624207201 3.1376843248464947 7.857294145368205
//  LOG  3.686945064519575 1.847849797422291 1.5848931924611136 4.641588833612778 13.593563908785255
//  LOG  9.025541984728763 9.06730029785796 4.915050624207201 3.216926715464691 7.857294145368205
//  LOG  3.686945064519575 1.847849797422291 1.5848931924611136 4.298662347082277 13.593563908785255
//  LOG  9.025541984728763 9.06730029785796 4.705699265813284 3.216926715464691 7.857294145368205
//  LOG  3.686945064519575 1.847849797422291 1.847849797422291 4.298662347082277 13.593563908785255
//  LOG  9.025541984728763 9.06730029785796 4.705699265813284 4.848613648624247 7.857294145368205
//  LOG  3.686945064519575 1.847849797422291 1.847849797422291 27.12272579332028 13.593563908785255
//  LOG  9.025541984728763 8.619861452064184 4.705699265813284 4.848613648624247 7.857294145368205
//  LOG  3.686945064519575 2.51188643150958 1.847849797422291 27.12272579332028 13.593563908785255
//  LOG  9.025541984728763 8.619861452064184 4.705699265813284 4.848613648624247 7.906414767219847
//  LOG  3.686945064519575 2.51188643150958 1.847849797422291 27.12272579332028 8.576958985908941
//  LOG  9.025541984728763 8.157638754881095 4.705699265813284 4.848613648624247 7.906414767219847
//  LOG  3.686945064519575 1.847849797422291 1.847849797422291 27.12272579332028 8.576958985908941
//  LOG  9.025541984728763 8.157638754881095 4.705699265813284 4.848613648624247 7.908931158677198
//  LOG  3.686945064519575 1.847849797422291 1.847849797422291 27.12272579332028 7.943282347242816
//  LOG  8.642564443953866 8.157638754881095 4.705699265813284 4.848613648624247 7.908931158677198
//  LOG  3.4145488738336014 1.847849797422291 1.847849797422291 27.12272579332028 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.705699265813284 4.848613648624247 7.908931158677198
//  LOG  12.589254117941675 1.847849797422291 1.847849797422291 27.12272579332028 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.705699265813284 5.879535679757437 7.908931158677198
//  LOG  12.589254117941675 1.847849797422291 1.847849797422291 19.952623149688797 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.886624008103901 5.879535679757437 7.908931158677198
//  LOG  12.589254117941675 1.847849797422291 7.3564225445964135 19.952623149688797 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.886624008103901 7.477171007218656 7.908931158677198
//  LOG  12.589254117941675 1.847849797422291 7.3564225445964135 29.286445646252357 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.824815663836381 7.477171007218656 7.908931158677198
//  LOG  12.589254117941675 1.847849797422291 3.9810717055349722 29.286445646252357 7.943282347242816
//  LOG  8.911945189157525 8.157638754881095 4.824815663836381 7.477171007218656 8.106107190692708
//  LOG  12.589254117941675 1.847849797422291 3.9810717055349722 29.286445646252357 10.7977516232771
//  LOG  8.673036125934747 8.157638754881095 4.824815663836381 7.477171007218656 8.106107190692708
//  LOG  5.411695265464636 1.847849797422291 3.9810717055349722 29.286445646252357 10.7977516232771
//  LOG  8.673036125934747 7.69362295414815 4.824815663836381 7.477171007218656 8.106107190692708
//  LOG  5.411695265464636 1.3593563908785256 3.9810717055349722 29.286445646252357 10.7977516232771
//  LOG  8.673036125934747 7.69362295414815 4.824815663836381 7.477171007218656 8.23537457638801
//  LOG  5.411695265464636 1.3593563908785256 3.9810717055349722 29.286445646252357 10
//  LOG  8.623226885037276 7.69362295414815 4.824815663836381 7.477171007218656 8.23537457638801
//  LOG  7.943282347242816 1.3593563908785256 3.9810717055349722 29.286445646252357 10
//  LOG  8.623226885037276 7.69362295414815 4.824815663836381 7.703816767273772 8.23537457638801
//  LOG  7.943282347242816 1.3593563908785256 3.9810717055349722 10.7977516232771 10
//  LOG  8.623226885037276 7.69362295414815 4.695392773786091 7.703816767273772 8.23537457638801
//  LOG  7.943282347242816 1.3593563908785256 2.9286445646252366 10.7977516232771 10
//  LOG  8.623226885037276 7.69362295414815 4.695392773786091 8.037271602307445 8.23537457638801
//  LOG  7.943282347242816 1.3593563908785256 2.9286445646252366 12.589254117941675 10
//  LOG  8.623226885037276 7.69362295414815 4.8399243420963565 8.037271602307445 8.23537457638801
//  LOG  7.943282347242816 1.3593563908785256 6.812920690579613 12.589254117941675 10
//  LOG  8.623226885037276 7.268680239437979 4.8399243420963565 8.037271602307445 8.23537457638801
//  LOG  7.943282347242816 1.4677992676220695 6.812920690579613 12.589254117941675 10
//  LOG  8.771648763329763 7.268680239437979 4.8399243420963565 8.037271602307445 8.23537457638801
//  LOG  10.7977516232771 1.4677992676220695 6.812920690579613 12.589254117941675 10
//  LOG  8.771648763329763 6.908743845242472 4.8399243420963565 8.037271602307445 8.23537457638801
//  LOG  10.7977516232771 1.9952623149688795 6.812920690579613 12.589254117941675 10
//  LOG  8.80506214559861 6.908743845242472 4.8399243420963565 8.037271602307445 8.23537457638801
//  LOG  9.261187281287935 1.9952623149688795 6.812920690579613 12.589254117941675 10
//  LOG  8.80506214559861 6.908743845242472 4.8399243420963565 8.959195115392722 8.23537457638801
//  LOG  9.261187281287935 1.9952623149688795 6.812920690579613 21.544346900318832 10
//  LOG  8.80506214559861 6.908743845242472 4.9402350336321055 8.959195115392722 8.23537457638801
//  LOG  9.261187281287935 1.9952623149688795 6.309573444801933 21.544346900318832 10
//  LOG  8.80506214559861 6.908743845242472 4.9402350336321055 8.849798100380687 8.23537457638801
//  LOG  9.261187281287935 1.9952623149688795 6.309573444801933 7.3564225445964135 10
//  LOG  8.80506214559861 6.908743845242472 4.945124627586477 8.849798100380687 8.23537457638801
//  LOG  9.261187281287935 1.9952623149688795 5.011872336272722 7.3564225445964135 10
//  LOG  8.80506214559861 6.510888412645008 4.945124627586477 8.849798100380687 8.23537457638801
//  LOG  9.261187281287935 1.0797751623277096 5.011872336272722 7.3564225445964135 10
//  LOG  8.80506214559861 6.510888412645008 4.945124627586477 8.849798100380687 8.305391277398634
//  LOG  9.261187281287935 1.0797751623277096 5.011872336272722 7.3564225445964135 9.261187281287935
//  LOG  8.573448369388972 6.510888412645008 4.945124627586477 8.849798100380687 8.305391277398634
//  LOG  5.411695265464636 1.0797751623277096 5.011872336272722 7.3564225445964135 9.261187281287935
//  LOG  8.573448369388972 6.192613371827596 4.945124627586477 8.849798100380687 8.305391277398634
//  LOG  5.411695265464636 1.847849797422291 5.011872336272722 7.3564225445964135 9.261187281287935
//  LOG  8.573448369388972 6.192613371827596 4.945124627586477 8.849798100380687 8.90657268336439
//  LOG  5.411695265464636 1.847849797422291 5.011872336272722 7.3564225445964135 17.11328304161781
//  LOG  8.418927906771263 6.192613371827596 4.945124627586477 8.849798100380687 8.90657268336439
//  LOG  6.309573444801933 1.847849797422291 5.011872336272722 7.3564225445964135 17.11328304161781
//  LOG  8.418927906771263 6.192613371827596 4.945124627586477 9.105034141690478 8.90657268336439
//  LOG  6.309573444801933 1.847849797422291 5.011872336272722 12.589254117941675 17.11328304161781
//  LOG  8.418927906771263 6.192613371827596 4.945124627586477 9.115692352136538 8.90657268336439
//  LOG  6.309573444801933 1.847849797422291 5.011872336272722 9.261187281287935 17.11328304161781
//  LOG  8.418927906771263 6.192613371827596 5.239716873250677 9.115692352136538 8.90657268336439
//  LOG  6.309573444801933 1.847849797422291 9.261187281287935 9.261187281287935 17.11328304161781
//  LOG  8.418927906771263 5.838192280938017 5.239716873250677 9.115692352136538 8.90657268336439
//  LOG  6.309573444801933 1 9.261187281287935 9.261187281287935 17.11328304161781
//  LOG  8.418927906771263 5.838192280938017 5.239716873250677 9.115692352136538 8.9307768525643
//  LOG  6.309573444801933 1 9.261187281287935 9.261187281287935 9.261187281287935
//  LOG  8.640088398498278 5.838192280938017 5.239716873250677 9.115692352136538 8.9307768525643
//  LOG  11.659144011798316 1 9.261187281287935 9.261187281287935 9.261187281287935
//  LOG  8.640088398498278 5.838192280938017 5.239716873250677 9.115692352136538 8.75186698489286
//  LOG  11.659144011798316 1 9.261187281287935 9.261187281287935 6.309573444801933
//  LOG  8.481019430123917 5.838192280938017 5.239716873250677 9.115692352136538 8.75186698489286
//  LOG  6.309573444801933 1 9.261187281287935 9.261187281287935 6.309573444801933
//  LOG  8.481019430123917 5.838192280938017 5.239716873250677 9.964008409549093 8.75186698489286
//  LOG  6.309573444801933 1 9.261187281287935 21.544346900318832 6.309573444801933
//  LOG  8.481019430123917 5.838192280938017 5.239716873250677 10.754422774507798 8.75186698489286
//  LOG  6.309573444801933 1 9.261187281287935 21.544346900318832 6.309573444801933
//  LOG  8.481019430123917 5.838192280938017 5.384192319314259 10.754422774507798 8.75186698489286
//  LOG  6.309573444801933 1 7.3564225445964135 21.544346900318832 6.309573444801933
//  LOG  8.481019430123917 5.471388391863601 5.384192319314259 10.754422774507798 8.75186698489286
//  LOG  6.309573444801933 0.4641588833612779 7.3564225445964135 21.544346900318832 6.309573444801933
//  LOG  8.481019430123917 5.471388391863601 5.384192319314259 10.754422774507798 8.619524479953977
//  LOG  6.309573444801933 0.4641588833612779 7.3564225445964135 21.544346900318832 6.812920690579613
//  LOG  8.404260228843464 5.471388391863601 5.384192319314259 10.754422774507798 8.619524479953977
//  LOG  7.3564225445964135 0.4641588833612779 7.3564225445964135 21.544346900318832 6.812920690579613
//  LOG  8.404260228843464 5.190722229528268 5.384192319314259 10.754422774507798 8.619524479953977
//  LOG  7.3564225445964135 1.3593563908785256 7.3564225445964135 21.544346900318832 6.812920690579613
//  LOG  8.147439625216025 5.190722229528268 5.384192319314259 10.754422774507798 8.619524479953977
//  LOG  4.641588833612778 1.3593563908785256 7.3564225445964135 21.544346900318832 6.812920690579613
//  LOG  8.147439625216025 5.190722229528268 5.384192319314259 10.485396107529567 8.619524479953977
//  LOG  4.641588833612778 1.3593563908785256 7.3564225445964135 6.812920690579613 6.812920690579613
//  LOG  8.147439625216025 5.190722229528268 5.358779671558602 10.485396107529567 8.619524479953977
//  LOG  4.641588833612778 1.3593563908785256 5.011872336272722 6.812920690579613 6.812920690579613
//  LOG  8.147439625216025 5.190722229528268 5.358779671558602 11.03096414434027 8.619524479953977
//  LOG  4.641588833612778 1.3593563908785256 5.011872336272722 18.478497974222908 6.812920690579613
//  LOG  8.147439625216025 5.190722229528268 5.85229468171511 11.03096414434027 8.619524479953977
//  LOG  4.641588833612778 1.3593563908785256 12.589254117941675 18.478497974222908 6.812920690579613
//  LOG  8.147439625216025 6.0976774826348965 5.85229468171511 11.03096414434027 8.619524479953977
//  LOG  4.641588833612778 18.478497974222908 12.589254117941675 18.478497974222908 6.812920690579613
//  LOG  8.147439625216025 6.0976774826348965 5.85229468171511 11.03096414434027 8.573367668880515
//  LOG  4.641588833612778 18.478497974222908 12.589254117941675 18.478497974222908 7.943282347242816
//  LOG  8.147439625216025 6.364029953841649 5.85229468171511 11.03096414434027 8.573367668880515
//  LOG  4.641588833612778 10 12.589254117941675 18.478497974222908 7.943282347242816
//  LOG  8.147439625216025 6.364029953841649 5.85229468171511 11.015046256716909 8.573367668880515
//  LOG  4.641588833612778 10 12.589254117941675 10.7977516232771 7.943282347242816
//  LOG  8.147439625216025 6.364029953841649 6.92335348532026 11.015046256716909 8.573367668880515
//  LOG  4.641588833612778 10 21.544346900318832 10.7977516232771 7.943282347242816
//  LOG  8.147439625216025 6.364029953841649 6.92335348532026 10.895336860536844 8.573367668880515
//  LOG  4.641588833612778 10 21.544346900318832 9.261187281287935 7.943282347242816
//  LOG  8.147439625216025 6.364029953841649 7.378627753875218 10.895336860536844 8.573367668880515
//  LOG  4.641588833612778 10 13.593563908785255 9.261187281287935 7.943282347242816
//  LOG  8.147439625216025 6.47182160247391 7.378627753875218 10.895336860536844 8.573367668880515
//  LOG  4.641588833612778 7.943282347242816 13.593563908785255 9.261187281287935 7.943282347242816
//  LOG  8.147439625216025 6.47182160247391 7.378627753875218 10.895336860536844 8.783986896499469
//  LOG  4.641588833612778 7.943282347242816 13.593563908785255 9.261187281287935 11.659144011798316
//  LOG  7.884741876735845 6.47182160247391 7.378627753875218 10.895336860536844 8.783986896499469
//  LOG  4.298662347082277 7.943282347242816 13.593563908785255 9.261187281287935 11.659144011798316
//  LOG  7.884741876735845 6.615507456683171 7.378627753875218 10.895336860536844 8.783986896499469
//  LOG  4.298662347082277 8.576958985908941 13.593563908785255 9.261187281287935 11.659144011798316
//  LOG  7.884741876735845 6.615507456683171 7.378627753875218 10.895336860536844 9.26620371963586